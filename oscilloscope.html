<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Oscilloscope with FFT</title>
    <style>
        canvas {
            width: 100%;
            height: 400px;
            background: #000;
        }
    </style>
</head>
<body>
    <h1>Web Oscilloscope with FFT</h1>
    <canvas id="oscilloscope"></canvas>

    <script>
        // 오실로스코프를 그릴 캔버스와 컨텍스트를 가져옵니다.
        const canvas = document.getElementById('oscilloscope');
        const canvasCtx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = 400;

        // AudioContext 및 필요한 요소들을 초기화합니다.
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioContext.createAnalyser();
        analyser.fftSize = 2048;  // FFT 사이즈 설정

        const bufferLength = analyser.frequencyBinCount;  // 주파수 데이터 크기
        const dataArray = new Uint8Array(bufferLength);  // 주파수 데이터를 저장할 배열

        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            const source = audioContext.createMediaStreamSource(stream);
            source.connect(analyser);
            draw();
        }).catch(err => {
            console.error('Error accessing microphone:', err);
        });

        function draw() {
            requestAnimationFrame(draw);

            // 주파수 데이터를 가져옴
            analyser.getByteFrequencyData(dataArray);

            // 캔버스를 초기화
            canvasCtx.fillStyle = 'black';
            canvasCtx.fillRect(0, 0, canvas.width, canvas.height);

            // 주파수 데이터를 그리기
            const barWidth = (canvas.width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;

            for (let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i];

                // 각 주파수 대역을 막대 그래프로 시각화
                canvasCtx.fillStyle = `rgb(${barHeight + 100},50,50)`;
                canvasCtx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);

                x += barWidth + 1;
            }
        }
    </script>
</body>
</html>
